# 철도운임 및 트럭운임 구조 변경 사항

## 변경 날짜
2025-01-XX

## 변경 개요
철도운임(PortBorderTable)과 트럭운임(BorderDestinationTable)의 데이터 구조를 변경하여, 같은 대리점이라도 유효기간이 겹치지 않으면 여러 개의 운임 레코드를 누적할 수 있도록 개선했습니다.

## 주요 변경 사항

### 1. 이전 구조
- **제한**: 각 대리점당 하나의 운임 레코드만 존재
- **표시**: 테이블에서 각 대리점이 1개 행으로만 표시됨
- **수정 방식**: 기존 레코드를 덮어쓰기

### 2. 새로운 구조
- **유연성**: 각 대리점이 여러 개의 운임 레코드를 가질 수 있음
- **조건**: 유효기간이 겹치지 않아야 함
- **표시**: 테이블에서 각 대리점이 유효기간별로 여러 행으로 표시됨
- **추가 방식**: 항상 새로운 레코드로 추가

### 3. 테이블 표시 변경

#### 철도운임 (PortBorderTable)
```
대리점 | POL | 양하포트들 | 유효기간 | 상태 | 작업
------|-----|----------|---------|------|-----
A사   | 상해 | $100/$200 | 2024-01~03 | 만료 | 수정/삭제
A사   | 상해 | $110/$210 | 2024-04~06 | 유효 | 수정/삭제
A사   | 청도 | $120/$220 | 2024-01~03 | 만료 | 수정/삭제
B사   | 상해 | $130/$230 | 2024-01~06 | 유효 | 수정/삭제
```

#### 트럭운임 (BorderDestinationTable)
```
대리점 | 목적지들 | 유효기간 | 상태 | 작업
------|---------|---------|------|-----
X사   | $50/$60 | 2024-01~03 | 만료 | 수정/삭제
X사   | $55/$65 | 2024-04~06 | 유효 | 수정/삭제
Y사   | $70/$80 | 2024-01~06 | 유효 | 수정/삭제
```

### 4. 정렬 순서
- **1차**: 대리점 이름 (알파벳순)
- **2차**: POL (철도운임만 해당, 알파벳순)
- **3차**: 유효기간 시작일 (최신순 - 내림차순)

### 5. 기능 변경

#### 추가 다이얼로그
- **이전**: 기존 데이터가 있으면 자동으로 로드하여 수정 모드
- **새로운**: 항상 새로운 레코드 추가 모드
- **유효성 검사**: 같은 대리점(+POL)의 기존 레코드와 유효기간 중복 체크

#### 수정 다이얼로그
- **변경 없음**: 선택한 레코드의 데이터를 수정
- **삭제 기능**: 운임을 비우면 해당 목적지/포트의 운임 삭제

#### 삭제 기능
- **이전**: 대리점의 모든 운임 삭제
- **새로운**: 선택한 유효기간의 운임만 삭제
- **확인 메시지**: 유효기간 정보 포함

## 영향받는 파일

### 수정된 파일
1. `/workspace/shadcn-ui/src/components/freight/PortBorderTable.tsx`
   - 철도운임 테이블 컴포넌트
   - FreightGroup 인터페이스 추가
   - 그룹화 로직 변경

2. `/workspace/shadcn-ui/src/components/freight/BorderDestinationTable.tsx`
   - 트럭운임 테이블 컴포넌트
   - FreightGroup 인터페이스 추가
   - 그룹화 로직 변경

## 사용자 가이드

### 새로운 운임 추가하기
1. "운임 추가" 버튼 클릭
2. 대리점 선택
3. POL 선택 (철도운임만 해당)
4. 유효기간 입력 (기존 레코드와 겹치지 않아야 함)
5. 각 목적지/포트별 운임 입력
6. "추가" 버튼 클릭

### 기존 운임 수정하기
1. 수정하려는 행의 "수정" 버튼 클릭
2. 유효기간 또는 운임 수정
3. "수정 저장" 버튼 클릭

### 운임 삭제하기
1. 삭제하려는 행의 휴지통 아이콘 클릭
2. 확인 메시지에서 "확인" 클릭
3. 해당 유효기간의 모든 운임이 삭제됨

## 주의사항

### 유효기간 중복
- 같은 대리점(+POL)의 기존 레코드와 유효기간이 겹치면 경고 메시지 표시
- "경고 무시하고 계속" 버튼으로 강제 추가 가능 (권장하지 않음)

### 데이터 마이그레이션
- 기존 데이터는 자동으로 새로운 구조로 표시됨
- 데이터베이스 스키마 변경 없음
- 이전 버전과 호환됨

## 테스트 시나리오

### 시나리오 1: 연속된 유효기간 추가
1. A 대리점, 2024-01-01 ~ 2024-03-31 운임 추가
2. A 대리점, 2024-04-01 ~ 2024-06-30 운임 추가
3. 결과: 두 개의 행으로 표시됨

### 시나리오 2: 중복 유효기간 시도
1. A 대리점, 2024-01-01 ~ 2024-03-31 운임 추가
2. A 대리점, 2024-02-01 ~ 2024-04-30 운임 추가 시도
3. 결과: 경고 메시지 표시

### 시나리오 3: 과거 운임 추가
1. A 대리점, 2024-04-01 ~ 2024-06-30 운임 추가
2. A 대리점, 2024-01-01 ~ 2024-03-31 운임 추가
3. 결과: 최신 운임(04-06)이 위에 표시됨

## 향후 개선 사항
- [ ] 유효기간 갭 감지 및 경고
- [ ] 운임 이력 시각화 (타임라인)
- [ ] 대량 운임 업로드 기능
- [ ] 운임 템플릿 복사 기능
